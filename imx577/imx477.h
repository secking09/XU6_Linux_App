#ifndef IMX477_H_
#define IMX477_H_
#include <stdint.h>


#define SENSOR_DEBUG

/* Misc Macros; Fill the correct I2C addresses below */
#define IMX477_I2C_READ_ADDRESS (0x35)  // Read address = 0xFF
#define IMX477_I2C_WRITE_ADDRESS (0x34) // Write address = 0xFE


#define IMX477_START_STREAM_VALUE 0x01
#define IMX477_STOP_STREAM_VALUE 0x00

#define IMX477_GRP_PARAM_HOLD 0x0104
#define IMX477_GRP_PARAM_HOLD_START 0x01
#define IMX477_GRP_PARAM_HOLD_RELEASE 0x00

#define IMX477_MODE_SEL 0x0100
#define IMX477_EXCK_FREQ_15_8 0x0136
#define IMX477_EXCK_FREQ_7_0 0x0137
#define IMX477_TEMP_SEN_OUT 0x0138
#define IMX477_TEMP_SEN_OUT_ENABLED 0x01
#define IMX477_TEMP_SEN_OUT_DISABLED 0x00

#define IMX477_FRAME_BLANKSTOP_CL 0xE000
#define IMX477_PSMODE_SEL 0x3F4C
#define IMX477_PSMODE_SEL_LP11 0x01
#define IMX477_PSMODE_SEL_LP00 0x02

#define IMX477_DPHY_CTRL 0x0808
#define IMX477_PD_AREA_WIDTH_12_8 0x38A8
#define IMX477_PD_AREA_WIDTH_7_0 0x38A9
#define IMX477_PD_AREA_HEIGHT_12_8 0x38AA
#define IMX477_PD_AREA_HEIGHT_7_0 0x38AB
#define IMX477_CSI_DT_FMT_H 0x0112
#define IMX477_CSI_DT_FMT_L 0x0113

/* Number of lanes*/
#define IMX477_CSI_LANE_MODE 0x0114
#define IMX477_CSI_LANE_MODE_2LANES 0x01
#define IMX477_CSI_LANE_MODE_4LANES 0x03

#define IMX477_FLASH_TRIG_RS 0x0C1B

/* Frame control for long exposure values */
#define IMX477_FRM_LENGTH_CTL 0x0350
#define IMX477_FRM_LENGTH_CTL_AUTOMATIC 0x01
#define IMX477_FRM_LENGTH_CTL_MANUAL 0x00

#define IMX477_LINE_LENGTH_PCK_15_8 0x0342
#define IMX477_LINE_LENGTH_PCK_7_0 0x0343
#define IMX477_FRM_LENGTH_LINES_15_8 0x0340
#define IMX477_FRM_LENGTH_LINES_7_0 0x0341
#define IMX477_X_ADD_STA_12_8 0x0344
#define IMX477_X_ADD_STA_7_0 0x0345
#define IMX477_Y_ADD_STA_12_8 0x0346
#define IMX477_Y_ADD_STA_7_0 0x0347
#define IMX477_X_ADD_END_12_8 0x0348
#define IMX477_X_ADD_END_7_0 0x0349
#define IMX477_Y_ADD_END_12_8 0x034A
#define IMX477_Y_ADD_END_7_0 0x034B
#define IMX477_SME_HDR_MODE 0x0220
#define IMX477_SME_HDR_RESO_REDU_H_7_4_SME_HDR_RESO_REDU_V_3_0 0x0221
#define IMX477_X_EVN_INC 0x0381
#define IMX477_X_ODD_INC 0x0383
#define IMX477_Y_EVN_INC 0x0385
#define IMX477_Y_ODD_INC 0x0387
#define IMX477_BINNING_MODE 0x0900
#define IMX477_BINNING_TYPE_H_7_4_BINNING_TYPE_V_3_0 0x0901
#define IMX477_BINNING_WEIGHTING 0x0902
#define IMX477_BINNING_SUB_WEIGHTING 0x3250
#define IMX477_SCALE_MODE 0x0401
#define IMX477_SCALE_M_8 0x0404
#define IMX477_SCALE_M_7_0 0x0405
#define IMX477_DIG_CROP_X_OFFSET_12_8 0x0408
#define IMX477_DIG_CROP_X_OFFSET_7_0 0x0409
#define IMX477_DIG_CROP_Y_OFFSET_12_8 0x040A
#define IMX477_DIG_CROP_Y_OFFSET_7_0 0x040B
#define IMX477_DIG_CROP_IMAGE_WIDTH_12_8 0x040C
#define IMX477_DIG_CROP_IMAGE_WIDTH_7_0 0x040D
#define IMX477_DIG_CROP_IMAGE_HEIGHT_12_8 0x040E
#define IMX477_DIG_CROP_IMAGE_HEIGHT_7_0 0x040F
#define IMX477_X_OUT_SIZE_12_8 0x034C
#define IMX477_X_OUT_SIZE_7_0 0x034D
#define IMX477_Y_OUT_SIZE_12_8 0x034E
#define IMX477_Y_OUT_SIZE_7_0 0x034F
#define IMX477_IVT_PXCK_DIV 0x0301
#define IMX477_IVT_SYCK_DIV 0x0303
#define IMX477_IVT_PREPLLCK_DIV 0x0305
#define IMX477_IVT_PLL_MPY_10_8 0x0306
#define IMX477_IVT_PLL_MPY_7_0 0x0307
#define IMX477_IOP_PXCK_DIV 0x0309
#define IMX477_IOP_SYCK_DIV 0x030B
#define IMX477_IOP_PREPLLCK_DIV 0x030D
#define IMX477_IOP_PLL_MPY_10_8 0x030E
#define IMX477_IOP_PLL_MPY_7_0 0x030F
#define IMX477_PLL_MULT_DRIV 0x0310
#define IMX477_REQ_LINK_BIT_RATE_MBPS_31_24 0x0820
#define IMX477_REQ_LINK_BIT_RATE_MBPS_23_16 0x0821
#define IMX477_REQ_LINK_BIT_RATE_MBPS_15_8 0x0822
#define IMX477_REQ_LINK_BIT_RATE_MBPS_7_0 0x0823
#define IMX477_TCLK_POST_EX_9_8 0x080A
#define IMX477_TCLK_POST_EX_7_0 0x080B
#define IMX477_THS_PREPARE_EX_9_8 0x080C
#define IMX477_THS_PREPARE_EX_7_0 0x080D
#define IMX477_THS_ZERO_MIN_EX_9_8 0x080E
#define IMX477_THS_ZERO_MIN_EX_7_0 0x080F
#define IMX477_THS_TRAIL_EX_9_8 0x0810
#define IMX477_THS_TRAIL_EX_7_0 0x0811
#define IMX477_TCLK_TRAIL_MIN_EX_9_8 0x0812
#define IMX477_TCLK_TRAIL_MIN_EX_7_0 0x0813
#define IMX477_TCLK_PREPARE_EX_9_8 0x0814
#define IMX477_TCLK_PREPARE_EX_7_0 0x0815
#define IMX477_TCLK_ZERO_EX_9_8 0x0816
#define IMX477_TCLK_ZERO_EX_7_0 0x0817
#define IMX477_TLPX_EX_9_8 0x0818
#define IMX477_TLPX_EX_7_0 0x0819
#define IMX477_PDAF_CTRL1_0 0x3E37
#define IMX477_POWER_SAVE_ENABLE 0x3F50
#define IMX477_LINE_LENGTH_INCK_15_8 0x3F56
#define IMX477_LINE_LENGTH_INCK_7_0 0x3F57
#define IMX477_IMG_ORIENTATION_V_H 0x0101
#define IMX477_MAP_COUP_CORR_EN 0x0B05
#define IMX477_SING_DEF_CORR_EN 0x0B06
#define IMX477_CIT_LSHIFT 0x3100

/* Exposure settings */
#define IMX477_COARSE_INTEG_TIME_15_8 0x0202
#define IMX477_COARSE_INTEG_TIME_7_0 0x0203

#define IMX477_FLASH_TRIG_RS 0x0C1B
#define IMX477_ANA_GAIN_GLOBAL_9_8 0x0204
#define IMX477_ANA_GAIN_GLOBAL_7_0 0x0205
#define IMX477_DIG_GAIN_GR_15_8 0x020E
#define IMX477_DIG_GAIN_GR_7_0 0x020F
#define IMX477_DIG_GAIN_R_15_8 0x0210
#define IMX477_DIG_GAIN_R_7_0 0x0211
#define IMX477_DIG_GAIN_B_15_8 0x0212
#define IMX477_DIG_GAIN_B_7_0 0x0213
#define IMX477_DIG_GAIN_GB_15_8 0x0214
#define IMX477_DIG_GAIN_GB_7_0 0x0215
#define IMX477_DPGA_USE_GLOBAL_GAIN 0x3FF9

/* Fast frame transition */
#define IMX477_SHORT_FRAME_RS 0x3020
#define IMX477_SHORT_FRAME_RS_NORMAL 0x00
#define IMX477_SHORT_FRAME_RS_FAST 0x01

/* Embedded line configuration */
#define IMX477_EBD_SIZE_V_REGISTER 0xBCF1
#define IMX477_EBD_SIZE_V_EMBEDDED_DISABLED 0x00
#define IMX477_EBD_SIZE_V_EMBEDDED_TWO_LINES 0x02

#define IMX477_TESTMNT0 0x42a8
#define IMX477_TESTMNT1 0x42a9
#define IMX477_TESTMNT2 0x42aa
#define IMX477_MNTTEST2_SEL_8 0x4bd4
#define IMX477_MNTTEST2_SEL_7_0 0x4bd5
#define IMX477_MNTTEST1_SEL_8 0x4bd6
#define IMX477_MNTTEST1_SEL_7_0 0x4bd7
#define IMX477_MNTTEST3_SEL_8 0x4bdc
#define IMX477_MNTTEST3_SEL_7_0 0x4bdd
#define IMX477_XVS_IO_CTRL 0x3040
#define IMX477_VSYNC_POL 0x4F0C
#define IMX477_VSYNC_WID 0x4F0D
#define IMX477_HSYNC_POL 0x4F0E
#define IMX477_HSYNC_WID 0x4F0F
#define IMX477_PIX_ORDER 0x0006
#define IMX477_CKTESTSEL 0x42B0
#define IMX477_GPIOSEL 0x4270

#define IMX477_TP_MODE_8 0x0600
#define IMX477_TP_MODE_7_0 0x0601
#define IMX477_TD_R_11_8 0x0602
#define IMX477_TD_R_7_0 0x0603
#define IMX477_TD_GR_11_8 0x0604
#define IMX477_TD_GR_7_0 0x0605
#define IMX477_TD_B_11_8 0x0606
#define IMX477_TD_B_7_0 0x0607
#define IMX477_TD_GB_11_8 0x0608
#define IMX477_TD_GB_7_0 0x0609

#define IMX477_MANUAL_DATA_PEDESTAL_EN_REGISTER 0x3030
#define IMX477_MANUAL_DATA_PEDESTAL_FIXED_VALUE 0x00
#define IMX477_MANUAL_DATA_PEDESTAL_MANUAL_VALUE 0x01
#define IMX477_MANUAL_DATA_PEDESTAL_VALUE_11_8 0x3032
#define IMX477_MANUAL_DATA_PEDESTAL_VALUE_7_0 0x3033

#define IMX477_DOL_EN_REGISTER 0x00E3
#define IMX477_DOL_HDR_ENABLE_VALUE 0x00
#define IMX477_DOL_HDR_DISABLE_VALUE 0x01
#define IMX477_DOL_NUM_REGISTER 0x00E4
#define IMX477_DOL_NUM_DISABLE_VALUE 0x00
#define IMX477_DOL_NUM_2FRAMES_VALUE 0x01
#define IMX477_DOL_NUM_3FRAMES_VALUE 0x02
#define IMX477_DOL_NUM_INHIBIT_VALUE 0x03

#define IMX477_DOL_CSI_DT_FMT_H_2ND 0x00FC
#define IMX477_DOL_CSI_DT_FMT_L_2ND 0x00FD
#define IMX477_DOL_CSI_DT_FMT_H_3RD 0x00FE
#define IMX477_DOL_CSI_DT_FMT_L_3RD 0x00FF

/* Shutter time related defines */
#define IMX477_FINE_INTEG_TIME 0x0790
#define IMX477_IVTPXCK_FREQUENCY 210000000

/* Default sensor defines for exposure control */
#define IMX477_DEFAULT_EXPOSURE_TIME 1000
#define IMX477_MIN_EXPOSURE_TIME 460
#define IMX477_MAX_EXPOSURE_TIME 200000

#define IMX477_DEFAULT_GAIN 0
#define IMX477_MIN_GAIN 0
#define IMX477_MAX_GAIN 979

/* Module Serial Number */
#define IMX477_MODULE_SERIAL_NUMBER_31_24 0x001C
#define IMX477_MODULE_SERIAL_NUMBER_23_16 0x001D
#define IMX477_MODULE_SERIAL_NUMBER_15_8 0x001E
#define IMX477_MODULE_SERIAL_NUMBER_7_0 0x001F

/* OTP Configuration */
#define IMX477_OTP_PAGE_SETTING 0x0A02
#define IMX477_OTP_CTRL_CLR_WEN_EN 0x0A00
#define IMX477_OTP_STATUS 0x0A01

/*------------------------------------------------*/
/* Serial number defines */
/*------------------------------------------------*/
#define IMX477_SERIAL_NUMBER_ADDRESS 0x0A04
#define IMX477_SERIAL_NUMBER_PAGE 0
#define IMX477_SERIAL_NUMBER_SIZE 16 // It is actually 15 bytes, but use 16 and discard in application

/*------------------------------------------------*/
/* Sensor configuration defines */
/*------------------------------------------------*/
#define RAW12_4056x3042_LINE_LENGTH_PCK 0xBB80
#define RAW8_4056x3042_LINE_LENGTH_PCK 0x5DC0
#define RAW10_4056X3042_LINE_LENGTH_PCK 0xBB80
#define RAW8_676x762_LINE_LENGTH_PCK 0x1770
#define RAW12_676x762_LINE_LENGTH_PCK 0x5DBF
#define RAW8_1352x762_LINE_LENGTH_PCK 0x5DC0
#define RAW8_2028x1522_LINE_LENGTH_PCK 0x5DC0
#define RAW8_1012x762_LINE_LENGTH_PCK 0x1770
#define RAW10_1012x762_LINE_LENGTH_PCK 0x1770
#define RAW12_1012x762_LINE_LENGTH_PCK 0x1770

/*------------------------------------------------*/
/* Metada data position */
/*------------------------------------------------*/
#define IMX477_RAW8_EMBEDDED_FINE_INTEG_TIME_15_8_POS 34
#define IMX477_RAW8_EMBEDDED_FINE_INTEG_TIME_7_0_POS 36
#define IMX477_RAW8_EMBEDDED_COARSE_INTEG_TIME_15_8_POS 38
#define IMX477_RAW8_EMBEDDED_COARSE_INTEG_TIME_7_0_POS 40
#define IMX477_RAW8_EMBEDDED_LINE_LENGTH_PCK_15_8_POS 126
#define IMX477_RAW8_EMBEDDED_LINE_LENGTH_PCK_7_0_POS 128

#define IMX477_RAW10_EMBEDDED_FINE_INTEG_TIME_15_8_POS 42
#define IMX477_RAW10_EMBEDDED_FINE_INTEG_TIME_7_0_POS 45
#define IMX477_RAW10_EMBEDDED_COARSE_INTEG_TIME_15_8_POS 47
#define IMX477_RAW10_EMBEDDED_COARSE_INTEG_TIME_7_0_POS 50
#define IMX477_RAW10_EMBEDDED_LINE_LENGTH_PCK_15_8_POS 157
#define IMX477_RAW10_EMBEDDED_LINE_LENGTH_PCK_7_0_POS 160

#define IMX477_RAW12_EMBEDDED_FINE_INTEG_TIME_15_8_POS 51
#define IMX477_RAW12_EMBEDDED_FINE_INTEG_TIME_7_0_POS 54
#define IMX477_RAW12_EMBEDDED_COARSE_INTEG_TIME_15_8_POS 57
#define IMX477_RAW12_EMBEDDED_COARSE_INTEG_TIME_7_0_POS 60
#define IMX477_RAW12_EMBEDDED_LINE_LENGTH_PCK_15_8_POS 189
#define IMX477_RAW12_EMBEDDED_LINE_LENGTH_PCK_7_0_POS 192


#include <stdint.h>

typedef struct{

    uint16_t regAddr;
    uint8_t regData; 

} I2CReg;

extern I2CReg sensor_init[];
/*------------------------------------------------*/
/* Globals */
/*------------------------------------------------*/
extern int16_t g_imx477_gain;     // Global gain that is applied across resolutions when resolution is changed.
extern int16_t g_imx477_exposure; // Exposure in register value that is applied across resolutions when resolution is changed.
extern float g_imx477_exposure_time;
extern uint32_t g_imx477_current_line_length_pck;

extern I2CReg imx477_sensor_base_configuration_settings[];
extern I2CReg SENSOR_RAW12_4056x3040_ConfigurationSettings[];
extern I2CReg SENSOR_RAW8_4056x3040_ConfigurationSettings[];
extern I2CReg SENSOR_RAW8_676x504_ConfigurationSettings[];
extern I2CReg SENSOR_RAW12_676x504_ConfigurationSettings[];
extern I2CReg SENSOR_RAW8_1352x760_ConfigurationSettings[];
extern I2CReg SENSOR_RAW8_2028x1520_ConfigurationSettings[];
extern I2CReg SENSOR_RAW8_1012x760_ConfigurationSettings[];
extern I2CReg SENSOR_START_STREAM[];
extern I2CReg SENSOR_STOP_STREAM[];
extern I2CReg INCREASE_EXPOSURE[];


#endif // SENSOR_H
